역할(Role): 너는 가구 브랜드 '데스커(DESKER)'의 영업 데이터를 분석하고, 대리점주를 위한 전략 리포트를 자동으로 생성하는 Python 데이터 분석 전문가이자 Full-stack 개발자야.

목표(Objective): 첨부된 3개의 Raw Data(CSV)를 가공하여, 첨부된 PDF 보고서(DM대구칠성 등록고객 보고서)와 같은 형식의 분석 리포트를 웹 대시보드(Streamlit)로 시각화하고, PDF로 다운로드하는 시스템을 구축해야 해.

. 유저 시나리오 (User Scenario)
사용자(본사 영업 담당자)는 다음과 같은 흐름으로 이 서비스를 이용한다.
    데이터 업로드 (Input):
    사용자가 웹 사이트에 접속하여 매출_수주 데이터.csv, 고객 마스터 데이터.csv, 제품 판매 데이터.csv 3개의 파일을 업로드한다.

    자동 전처리 및 분석 (Process):
    시스템은 업로드된 파일을 읽어 중복을 제거하고, 3개 데이터를 연결(Merge)하여 통합 DB를 생성한다.
    PDF 보고서에 포함된 핵심 지표(지역 밀도, 성장 고객, 제품 판매 비중)를 자동으로 계산한다.

    인터랙티브 대시보드 확인 (View):
    사용자가 사이드바에서 특정 대리점(예: DM대구칠성)을 선택한다.
    화면에 해당 대리점의 현황(지역별 매출, 성장 가능성 높은 고객 리스트 등)이 시각화된다.
    AI(Claude)가 분석한 "영업 전략 코멘트"가 함께 표시된다.

    리포트 수정 및 다운로드 (Edit & Export):
    사용자는 AI의 코멘트가 마음에 들지 않으면 채팅창을 통해 수정을 요청한다. (예: "수성구 지역 공략을 더 강조해줘")
    최종 확인 후 [PDF 다운로드] 버튼을 누르면, 첨부된 샘플 PDF와 동일한 양식의 파일이 생성된다.


TEP 1. 데이터 전처리 (Pre-processing)
    
    데이터 병합 (Data Merging) - 중요
    매출_수주 + 고객 마스터 병합:
    단순히 사업자 등록번호만으로 병합하면, 한 고객이 여러 대리점과 거래한 경우 데이터가 중복 부풀리기(Cartesian Product)되는 오류가 발생함.
    따라서 반드시 ['사업자 등록번호', '실적대리점'] 2개의 컬럼을 기준으로 Left Join 하여, 해당 대리점의 실적에 맞는 고객 정보만 정확히 매칭할 것.

    매출_수주 + 제품 판매 병합:
    **['수주번호']**를 기준으로 Left Join 하여 제품 상세 정보를 연결할 것.

    지표별 데이터 활용 기준 (Metric Calculation Source)

    누적 매출액 (성장성 분석용):

    제품 판매 데이터(Line Item)를 합산하지 말고, 이미 주문 건별로 요약된 **매출_수주 데이터의 [수주금액]**을 사업자 등록번호별로 Sum 하여 계산할 것. (이 파일은 수주번호 중복이 없으므로 별도 중복 제거 불필요).

    구매 횟수:
    **매출_수주 데이터**에서 수주금액 > 0인 건들의 고유 개수(Count)로 산출할 것.

    제품 크로스셀링:
    **제품 판매 데이터**를 활용하여 동일 수주번호 내 품목 구성을 분석할 것.

    결측치 및 이상치 처리 (Data Cleaning)
    최초주문금액 보정:
    고객 마스터 데이터의 [최초주문금액]이 비어있거나 0인 경우, 매출_수주 데이터에서 해당 고객의 가장 오래된 날짜(Min Date)의 주문 금액을 찾아 채워 넣을 것 (Imputation).

    유효 데이터 필터링:
    반품 및 취소 건을 제외하기 위해, 모든 분석은 [수주금액] > 0 인 데이터만을 대상으로 수행할 것.

    4  . 대리점명 정규화 및 통합 (Agency Name Normalization)
    목적: 대리점명이 변경되었거나, 전략상 2개 대리점을 하나로 묶어서 관리해야 하는 경우를 반영하여 데이터를 통합한다.
    로직: 실적대리점 컬럼의 값을 아래 규칙에 따라 변경(Replace)한 후 데이터를 집계한다.

    [통합] DM대전둔산2 → DM대구칠성 (또는 DM대구칠성+대전둔산으로 변경하여 하나로 합산)
    [변경] DM송파오금 → DM공간플러스 (과거 명칭을 현재 명칭으로 통일)

    4-1. Club 1000 그룹핑 (Club 1000 Tagging)
    목적: 프리미엄 대리점 그룹인 'Club 1000'을 별도로 구분하여 비교 분석(Benchmark)에 활용한다.
    로직: 정규화된 실적대리점명이 아래 리스트에 포함될 경우, 별도의 컬럼 Club_1000_YeoBu (또는 Group)에 'True' 또는 **'Club 1000'**으로 태깅한다.

    Club 1000 목록:
    DM대구칠성 (대전둔산2 포함)
    DM공간플러스 (송파오금 포함)
    DM부산센텀
    DM송파문정
    DM오피스그룹
    DM에스엔피
    DM더라이즈
    DM드림OC

    [STEP 2] 핵심 지표 계산 로직 (Key Metrics)
    지역 분석 (Region Analysis)

    목표: '지역별 매출 현황' 지도 시각화
    로직: 매출_수주 데이터의 [시], [구], [동] 컬럼을 활용하여 GroupBy 집계.
    분류: 전체 매출 중 해당 대리점의 매출 비중을 계산하여 '주력 지역'과 '확장 필요 지역' 구분.

    고객 성장성 분석 (Growth Potential)
    목표: PDF 3~4페이지의 '성장 가능 고객' 도출
    성장배수 계산: $성장배수 = \frac{\text{누적주문금액}}{\text{최초주문금액}}$
    
    타겟 고객 정의:
    Condition A: 성장배수 ≥ 2.0 (재구매가 활발함)
    Condition B: 누적주문금액 ≥ 상위 30% (매출 기여도 높음)
    위 두 조건을 만족하는 고객을 High Potential 등급으로 태깅.
    
    제품 크로스셀링 분석 (Product Mix)
    목표: 단독 구매 대비 세트 구매 비중 확인
    로직: 제품 판매 데이터에서 동일 [주문번호] 내에 서로 다른 [카테고리(중분류)]가 2개 이상 존재하면 **'동시구매(Cross-sell)'**로 간주.
    단독 구매 건수 vs 동시 구매 건수 비율 산출.

    신제품 판매 분석 (New Product Analysis)
    목표: 대리점의 신제품 영업 집중도 및 시장 반응 확인
    데이터 소스: 제품 판매 데이터.csv 활용
    
    분석 로직:
    신제품 매출 비중: 신제품 구분 컬럼을 활용하여 **'신제품'**인 건과 **'기존제품'**인 건을 구분.
    공식: $\frac{\text{신제품 수주금액 합계}}{\text{전체 수주금액 합계}} \times 100 (\%)$

    월별 판매 추이:
    기준일자일을 월(Month) 단위로 그룹화하여, 월별 신제품 판매 수량(수량집계)의 변화 추세를 라인 차트로 시각화.

    3. 대시보드 UI/UX (Dashboard Design)
    3-1. 사이드바 (Controls)
    대리점 선택: 통합된 대리점명(예: DM대구칠성)만 노출. 선택 시 전체 대시보드 데이터 동기화.   비교 기준: vs 전체 평균 또는 vs Club 1000 평균 선택 가능.

    3-2. 메인 화면 구성
    Header (KPI): 총 매출, 성장률, 신제품 비중 등 핵심 지표 4개를 st.metric으로 표시 (목표 달성 여부에 따른 ▲/▼ 색상 강조).

    Row 1 (Map & Target):
    1-1. 지도 히트맵
    - 전체 대리점은 회색
    - 선택한 대리점은 다른색
    1-2. 공략 필요 지역(배정받았으나 매출 저조한 곳) 표로 안내
    - 지역 중 수주금액이 높은 곳 top5
    - 지역별 배정회원>등록회원 top5
    1-3. 1-1,1-2에 대한 데이터 해석을 텍스트 박스 안에 작성해줘
    1-4. 영업 인사이트를 텍스트 박스 안에 작성

Row 2 (Growth & Product):

성장성 산점도: X축(최초금액) / Y축(누적금액). Target 고객군은 별도 색상으로 하이라이팅.

제품 썬버스트 차트: 데스크 → 의자/서랍 등의 연관 구매 구조 시각화.

Row 3 (AI Insight Chat):

단순 텍스트가 아닌 채팅형 UI.

AI가 먼저 "대구칠성점은 Club 1000 대비 신제품 판매가 5% 부족합니다"라고 제안하면, 사용자가 "신제품 프로모션 전략을 더 구체적으로 써줘"라고 수정 요청 가능.s

 